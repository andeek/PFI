We would like to know what factors influence the yield for a particular crop. Since Thompson used a crop-rotation system, one thing that we looked at was whether the yeild of a crop planted on a particular field for a particular year was influenced by the type of crop that was planted on the same field during the previous year. We also tried to determine whether specific farming practices during a given year had an influence on the yield for a crop. The farming practices of Thompson are best described by the expense variables. For example, if ```Apply_NH4``` was positive for a given field and year, then we know that Thompson decided to use fertilizing on that particular crop for that year (it turns out he never actually used NH4). Thus, by looking at how the year-by-year expense for a particular practice are correlated to the yield of the corresponding crop, we can get some idea of how these factors influence yield.


```{r echo=FALSE}
yields <- dat %>%
  filter(item_type %in% c("Expense"), farmer == "Thompson") %>% 
  spread(item, value) %>% 
  select(-c(5))

yields <- yields %>% mutate(year_before = year - 1) %>%
  left_join(select(yields, 1:4), 
            by=c("field_id" = "field_id", "year_before" = "year")) %>%
  select(-c(2,38))

# Get crop yields
value <- dat %>% 
  filter(item_type %in% c("Unit Quantity"), farmer == "Thompson") %>%
  select(c(1,3,7))

# Add crop yields to yields df
yields <- yields %>% 
  left_join(value, by = c("field_id" = "field_id", "year" = "year")) %>%
  rename(crop = crop.x, prev_crop = crop.y, yield = value) %>%
  select(-3)

# Reorder variables
yields <- yields[,c(2,1,3,36,37,4:35)]
```

### Thompson Yield vs County Average

The first thing to look at is if the yield Thompson is achieving is significantly better than crop yield in the same area.  To do this, we will compare Thompson's crop yields to the crop yield in Boone County.  This data was obtained from the USDA website.  Line charts show the comparison of Thompson's yield to the county average over time.  It appears that Thompson's yield is higher than that of the county average.  To ensure that this is the case a paired t-test was performed for each of the four crops.

```{r echo=FALSE}
crops <- dat 
yieldperacres<-subset(crops,item=="Yield_Per_Acre_Bu_per_pound")
thompsonYield<-subset(yieldperacres,farmer=="Thompson")

ThompsonAve<-ddply(thompsonYield,.(year,crop),transform,averageYield=ave(value))
cornThompson<-subset(ThompsonAve,crop=="Corn")

countyYield<-subset(countyYield,Period=="YEAR")

cornCounty<-subset(countyYield,Commodity=="CORN")
sbCounty<-subset(countyYield,Commodity=="SOYBEANS")
hayCounty<-subset(countyYield,Commodity=="HAY")
oatCounty<-subset(countyYield,Commodity=="OATS")


plot(cornThompson$year,cornThompson$averageYield,type="l",main="Thompsone Yield vs Boone Average-Corn",ylab="Yield",xlab="Year")
lines(cornCounty$Year,cornCounty$Value,col="red")
legend(2005,120,c("Thompson","Boone County"), lty=c(1,1), lwd=c(2.5,2.5),col=c("black","red"))


soyThompson<-subset(ThompsonAve,crop=="SB")
plot(soyThompson$year,soyThompson$averageYield,type="l",main="Thompsone Yield vs Boone Average-Soybeans",ylim=c(20,70),ylab="Yield",xlab="Year")
lines(sbCounty$Year,sbCounty$Value,col="red")
legend(2005,35,c("Thompson","Boone County"), lty=c(1,1), lwd=c(2.5,2.5),col=c("black","red"))

hayThompson<-subset(ThompsonAve,crop=="Hay")
hayThompson$averageYield<-hayThompson$averageYield/2000
plot(hayThompson$year,hayThompson$averageYield,type="l",col="black",ylim=c(0,9),main="Thompsone Yield vs Boone Average-Hay",ylab="Yield",xlab="Year")
lines(hayCounty$Year,hayCounty$Value,col="red")
legend(2005,2.5,c("Thompson","Boone County"), lty=c(1,1), lwd=c(2.5,2.5),col=c("black","red"))


oatsThompson<-subset(ThompsonAve,crop=="Oats")
plot(oatsThompson$year,oatsThompson$averageYield,type="l",,ylim=c(30,150),main="Thompsone Yield vs Boone Average-Oats",ylab="Yield",xlab="Year")
lines(oatCounty$Year,oatCounty$Value,col="red")
legend(2005,60,c("Thompson","Boone County"), lty=c(1,1), lwd=c(2.5,2.5),col=c("black","red"))


```

```{r echo=FALSE}
###t-tests


ttestCorn<-merge(cornThompson,cornCounty,by.x="year",by.y="Year")
cornT<-t.test(x=ttestCorn$value,y=ttestCorn$Value,paired=T)
print(paste("The paired t-test for corn gives a t-value of: ", round(as.numeric(cornT$statistic),3) ,  "and a p-value of: ", round(cornT$p.value,7),sep=" "))

ttestsb<-merge(soyThompson,sbCounty,by.x="year",by.y="Year")
sbT<-t.test(x=ttestsb$value,y=ttestsb$Value,paired=T)
print(paste("The paired t-test for soybeans gives a t-value of: ", round(as.numeric(sbT$statistic),3) ,  "and a p-value of: ", round(sbT$p.value,9),sep=" "))

ttestHay<-merge(hayThompson,hayCounty,by.x="year",by.y="Year")
hayT<-t.test(x=ttestHay$value,y=ttestHay$Value,paired=T)
print(paste("The paired t-test for hay gives a t-value of: ", round(as.numeric(hayT$statistic),3) ,  "and a p-value of: ", round(hayT$p.value,9),sep=" "))

ttestOats<-merge(oatsThompson,oatCounty,by.x="year",by.y="Year")
oatsT<-t.test(x=ttestOats$value,y=ttestOats$Value,paired=T)
print(paste("The paired t-test for oats gives a t-value of: ", round(as.numeric(oatsT$statistic),3) ,  "and a p-value of: ", round(oatsT$p.value,9),sep=" "))

```

Interpret t-tests....

### Yield by previous crop

Soy beans and oats are always preceded by corn according to Thompson's rotation system. However, corn is preceded by either hay or soy beans, and hay is preceded by either hay or oats. The boxplots below illustrate how the yield for corn and hay vary based on the crop that was planted on the same field during the previous year.

```{r echo=FALSE}
corn <- yields %>% filter(crop == "Corn", prev_crop != "Oats") %>%
  select(-3)
hay <- yields %>% filter(crop == "Hay") %>%
  select(-3)
```

```{r message=FALSE, echo=FALSE, fig.height=4}
plot1 <- qplot(prev_crop, yield, data=filter(corn, !is.na(prev_crop))) +
  ggtitle("Corn") + geom_boxplot() + xlab("Previous Crop")
plot2 <- qplot(prev_crop, yield, data=filter(hay, !is.na(prev_crop))) + 
  ggtitle("Hay") + geom_boxplot() + xlab("Previous Crop")
grid.arrange(plot1, plot2, ncol=2)
```

The plots show that the yield for corn when hay was planted during the year before is slightly higher than when when soy beans were planted during the year before. The yield of hay is also slightly higher when the previous crop was oats, as opposed to hay. To determine if these differences are statistically signficant, we used a two-sample t-test for the yields of each crop based on the preceding crop. The resulting p-value for the yield of corn was 0.4993, and was 0.7785 for hay. Thus, there is not significant evidence that planting hay or soy beans before corn has any difference on the yield of corn. Similarly, there is no evidence that planting hay or oats before hay has any difference on the yield of hay.

```{r, echo=FALSE}
# Is there a statistically significant difference in the yields for corn and hay based
# on the previous crop?
# corn1 <- corn %>% filter(!is.na(prev_crop), prev_crop == "Hay") %>% select(c(3,4))
# corn2 <- corn %>% filter(!is.na(prev_crop), prev_crop == "SB") %>% select(c(3,4))
# hay1 <- hay %>% filter(!is.na(prev_crop), prev_crop == "Hay") %>% select(c(3,4))
# hay2 <- hay %>% filter(!is.na(prev_crop), prev_crop == "Oats") %>% select(c(3,4))
#t.test(corn1$yield, corn2$yield) # p-value of 0.4993
#t.test(hay1$yield, hay2$yield) # p-value of 0.7785
```

A future study could further examine these variations by looking at how the yields of soy beans and oats are affected if the previous crop is something other than corn, or how the yields of corn and hay are affected by different preceding crops other the ones studied here. Obviously the knowledge that one crop performs signficantly better when a certain crop is planted on the same field the year before could be very valuable information. This could help the farmer develop an optimized rotation strategy.

## Yield by expense

After examining how each individual expense related to the yield of each crop, we found four interesting relationships: three having to do with corn and one having to do with soy beans.

```{r echo=FALSE, fig.width=6, fig.height=4}
yields %>% filter(crop == "Corn", Spring_Tillage > 0) %>%
  ggplot(aes(Spring_Tillage, yield)) + geom_point() + geom_smooth(method="lm")
```

Corn and ```Spring_Tillage``` have a moderately strong positive relationship. As the money spent on tilling in the spring increases, the yield of corn generally increases. The plot below illustrates this relationship after removing all the years when no money was spent on spring tillage.

```{r echo=FALSE, fig.width=6, fig.height=4}
yields %>% filter(crop == "Corn") %>%
  ggplot(aes(Rotary_Hoe, yield)) + geom_point() + 
  stat_smooth(method = "lm", formula = y ~ x + I(x^2), size = 1)
```

The plot above shows the expenses of ```Rotary_Hoe``` against the yield of corn with a quadratic trend fitted to the data. The trend suggests that the more money spent on ```Rotary_Hoe```, the higher the expected yield will be, but the marginal benifit to yield decreases as the expense increases.

```{r echo=FALSE, fig.width=6, fig.height=4}
yields %>% filter(crop == "Corn") %>%
  ggplot(aes(Maunure_Charge, yield)) + geom_point() + 
  stat_smooth(method = "lm", formula = y ~ x + I(x^2), size = 1)
```

The amount spent on maunure exhibits a concave-down, quadratic relationship with the yield of corn. The expected yield increases as the expense on maunure increases up to a point, after which the expected yield actually decreases.

```{r echo=FALSE, fig.width=6, fig.height=4}
yields %>% filter(crop == "SB") %>%
 ggplot(aes(Herbicides, yield)) + geom_point() + 
 stat_smooth(method = "lm", formula = y ~ x + I(x^2), size = 1)
```

The amount of money spend on herbicides appears to have a quadratic, concave-down relationship with the yield of soy beans.

